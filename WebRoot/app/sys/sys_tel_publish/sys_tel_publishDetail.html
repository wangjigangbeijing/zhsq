

<script src="./sys/sys_tel_publish/sys_tel_publishDetail.js"></script>


<!--script language="javascript" type="text/javascript" src="../plugins/telbox/qnviccub.js"></script>
<script language="javascript" type="text/javascript" src="../plugins/telbox/qnvfunc.js"></script>
<script language="javascript" type="text/javascript" src="../plugins/telbox/json2.js"></script>
<script language="javascript" type="text/javascript" src="../plugins/telbox/deviceapi.js"></script-->


<section class="content">
      <div class="container-fluid">
        <div class="row">
          <div class="col-12">
			 <div class="card">
              <div class="card card-info">
              <form class="form-horizontal">
                <div class="card-body">
                    
										<div class='form-group row'>
						<label class='col-md-2 control-label'>通知标题</label>
  				<div class='col-md-9'>
 					<input type='text' class='form-control' id='title'>
 						</div>
 					</div>
					<div class='form-group row'>
						<label class='col-md-2 control-label'>类别</label>
  				<div class='col-md-9'>
						<select class='form-control field' name='category' id='category' onchange="loadtelxl(); return false;">
 						<option value=''>请选择</option>
						</select>
 						</div>
 					</div>
					<div class='form-group row'>
						<label class='col-md-2 control-label'>子类</label>
  				<div class='col-md-9'>
						<select class='form-control field' name='telxl' id='telxl'>
 						<option value=''>请选择</option>
						</select>
 						</div>
 					</div>
 					</div>
					
					<div class='form-group row'>
						<label class='col-md-2 control-label'>通知内容</label>
  				<div class='col-md-9'>
					<textarea class='form-control ckeditor field' name='content' id='content' rows='6'></textarea>
 						</div>
 					</div>
					
					<!--div class='form-group row'>
						<label class='col-md-2 control-label'>通知录音（本地路径）</label>
						<div class='col-md-9'>
							<div class="custom-file">
							  <input type='text' class='form-control' id='audioLocalPath'>
							</div>
 						</div>
 					</div-->
					
					<div class='form-group row'>
						<label class='col-md-2 control-label'>通知录音</label>
  				<div class='col-md-9'>
<div id='audiodiv' class='wu-example'>
<input type='text' class='form-control field' name='audio' id='audio' style='display:none;'>
<table class='table' id='audiopicktable'><thead><tr><th>名称</th><th>状态</th><th>操作</th></tr></thead><tbody></tbody></table>
<div class='btns'>
<div id='audiopick'>选择文件</div>
</div>
</div>
 						</div>
 					</div>
					
					<div class="form-group row">
                    <label class='col-md-2 col-form-label'>接收人(逗号分隔手机号码列表)</label>
					
					<div class='col-md-9'>
						<div class='form-group row'>
						
						<div class='col-md-10'>
						<input type="hidden" name="realmobileList" id="realMobileList"/>
						<textarea class="form-control" name="mobileList" rows="9" id="mobileList" readonly></textarea>
						</div>
						
						<!--div class='col-md-2'>
						<button class="btn btn-default" type="button" data-toggle="modal" data-target="#residentDialog" onclick="searchResident();">选择居民</button>&nbsp;
						<button class="btn btn-default" type="button" data-toggle="modal" data-target="#userDialog" onclick="searchUser();">选择内部人员</button>
						</div-->
						
						<div class='col-md-2'>
						<button style="margin-bottom:3px;" class="btn btn-primary" type="button" data-toggle="modal" data-target="#residentDialog" onclick="searchResident();">选择居民</button>&nbsp; <br/>
						<button style="margin-bottom:3px;" class="btn btn-primary" type="button" data-toggle="modal" data-target="#partymemberDialog" onclick="searchPartyMember();">选择党员</button>&nbsp; <br/>
						<button style="margin-bottom:3px;" class="btn btn-primary" type="button" data-toggle="modal" data-target="#volunteerDialog" onclick="searchVolunteer();">选择志愿者</button>&nbsp; <br/>
						<button style="margin-bottom:3px;"class="btn btn-danger" type="button" onclick="removeSelected();">&nbsp;清&nbsp;除&nbsp;</button>&nbsp;
						</div>
						
						</div>
 					</div>
                  </div>
				  
				  <div class="form-group row">
                    <label class='col-md-2 col-form-label'>接收人(逗号分隔手机号码列表)</label>
					
					<div class='col-md-9'>
						<div class='form-group row'>
						
						<div class='col-md-10'>
						<!--input type="hidden" name="realmobileList" id="realMobileList"/-->
						<textarea class="form-control" name="mobileList" rows="9" id="internalMobileList"></textarea>
						</div>
						
						<div class='col-md-2'>
						<!--button class="btn btn-default" type="button" data-toggle="modal" data-target="#residentDialog" onclick="searchResident();">选择居民</button>&nbsp;  -->
						<button class="btn btn-primary" type="button" data-toggle="modal" data-target="#userDialog" onclick="searchUser();">选择内部人员</button>
						</div>
						
						</div>
 					</div>
                  </div>
					
					
 					</div>
					<!--div class='form-group row'>
						<label class='col-md-2 control-label'>电话通知时间</label>
  				<div class='col-md-9'>
					<div data-date-viewmode='years' data-date-format='yyyy-mm-dd' class='input-append date dpYears'>
						<input type='text' size='16' class='form-control' id='publishtime'>
						<span class='input-group-btn add-on'>
							<button class='btn btn-danger' type='button'><i class='fa fa-calendar'></i></button>
						</span>
					</div>
 						</div>
 					</div-->
					
					
					<!--div class='form-group row'>
						<label class='col-md-2 control-label'>状态</label>
  				<div class='col-md-9'>
 					<input type='text' class='form-control' id='status'>
 						</div>
 					</div-->

					
                </div>
                <div class="card-footer">
				
				 <button class="btn btn-info" type="button" id="confirmBtn" onclick="addOrUpdate();">确定</button>
                  <button class="btn btn-default float-right" id="cancelBtn" type="button" onclick="gobackPage();">取消</button>
				  
                </div>
              </form>
            </div>
			  
          </div>
        </div>
      </div>
      </div>
	  
	  
	  
	  
	  <div class="modal fade" id="partymemberDialog">
        <div class="modal-dialog">
          <div class="modal-content" style="width:1000px;">
            <div class="modal-header">
              <h4 class="modal-title">党员选择</h4>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              
			  <form class="form-horizontal">
                <!--div class="card-body"-->
                  <div class="form-group row">
                    <label for="inputEmail3" class="col-sm-1 col-form-label">姓名</label>
                    <div class="col-sm-2">
                      <input class="form-control" id="partyMemberQry">
                    </div>
					
					<label for="inputEmail3" class="col-sm-1 col-form-label">党组织</label>
                    <div class="col-sm-4">
                      <select class="form-control" id="partyOrganizationQry"/>
                    </div>
					
					<button id="btnSearchPartyMember" type="button" class="btn btn-success" onclick="searchPartyMember();">查询</button>
					
                  </div>
              </form>
			  
			  <div class="card-body">
                <table class="table table-bordered table-striped" id="partyMemberDataTable">
                  <thead>
                  <tr>
					<th style='text-align:center;'><input type="checkbox" class="checkall"/></th>
                    <th style='text-align:center;'>姓名</th>
					<th style='text-align:center;'>手机号</th>
					<th style='text-align:center;'>党组织</th>
                  </tr>
                  </thead>
				  <tbody></tbody>
                </table>
              </div>
			  
            </div>
            <div class="modal-footer justify-content-between">
				<div>
              <button type="button" class="btn btn-default" onclick="javascript:addSelectedPartyMember();">添加选中</button>
			  <button type="button" class="btn btn-primary" onclick="javascript:addAllPartyMember();">添加全部</button>
			  </div>
              <button type="button" data-dismiss="modal" class="btn btn-primary">关闭</button>
            </div>
          </div>
          <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
      </div>
	  
	  <div class="modal fade" id="volunteerDialog">
        <div class="modal-dialog">
          <div class="modal-content" style="width:1000px;">
            <div class="modal-header">
              <h4 class="modal-title">志愿者选择</h4>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              
			  <form class="form-horizontal">
                  <div class="form-group row">
                    <label for="inputEmail3" class="col-sm-1 col-form-label">姓名</label>
                    <div class="col-sm-2">
                      <input class="form-control" id="volunteerQry">
                    </div>
					
					<label for="inputEmail3" class="col-sm-2 col-form-label">志愿者组织</label>
                    <div class="col-sm-4">
                      <select class="form-control" id="volunteerTeamQry"/>
                    </div>
					
					
					<button id="btnSearchVolunteer" type="button" class="btn btn-success" onclick="searchVolunteer();">查询</button>
					
                  </div>
              </form>
			  
			  <div class="card-body">
                <table class="table table-bordered table-striped" id="volunteerDataTable">
                  <thead>
                  <tr>
					<th style='text-align:center;'><input type="checkbox" class="checkall"/></th>
                    <th style='text-align:center;'>姓名</th>
					<th style='text-align:center;'>手机号</th>
					<th style='text-align:center;'>志愿者组织</th>
                  </tr>
                  </thead>
				  <tbody></tbody>
                </table>
              </div>
			  
            </div>
            <div class="modal-footer justify-content-between">
				<div>
              <button type="button" class="btn btn-default" onclick="javascript:addSelectedVolunteer();">添加选中</button>
			  <button type="button" class="btn btn-primary" onclick="javascript:addAllVolunteer();">添加全部</button>
			  </div>
              <button type="button" data-dismiss="modal" class="btn btn-primary">关闭</button>
            </div>
          </div>
          <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
      </div>
	  
	  
	  
	  
	  
	  
	  
	  

<div class="modal fade" id="residentDialog">
        <div class="modal-dialog">
          <div class="modal-content" style="width:1000px;">
            <div class="modal-header">
              <h4 class="modal-title">居民选择</h4>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              
			  <form class="form-horizontal">
                <!--div class="card-body"-->
                  <div class="form-group row">
                    <label for="inputEmail3" class="col-sm-1 col-form-label">姓名</label>
                    <div class="col-sm-2">
                      <input class="form-control" id="residentNameQry">
                    </div>
					
					
					 <label for="inputEmail3" class="col-sm-1 col-form-label">居民类别</label>
                    <div class="col-sm-4">
                      
					  <select id="characterQry" class="select2" style="width: 100%;">
					    <option value=''></option>
						<option value='中共党员'>中共党员</option>
						<option value='志愿者'>志愿者</option>
						<option value='居民代表'>居民代表</option>
						<option value='楼门长'>楼门长</option>
						<option value='军人'>军人</option>
						<option value='文体骨干'>文体骨干</option>
						<option value='优抚对象'>优抚对象</option>
						<option value='少数民族'>少数民族</option>
						<option value='0-6岁儿童'>0-6岁儿童</option>
						<option value='7-13岁青少年'>7-13岁青少年</option>
						<option value='13-18岁青少年'>13-18岁青少年</option>
						<option value='老年人'>老年人</option>
						<option value='80岁以上老人'>80岁以上老人</option>
						<option value='90岁以上老人'>90岁以上老人</option>
						<option value='独居老人'>独居老人</option>
						<option value='失独老人'>失独老人</option>
						<option value='空巢老人'>空巢老人</option>
						<option value='失业人员'>失业人员</option>
						<option value='待业人员'>待业人员</option>
						<option value='精神病人'>精神病人</option>
						<option value='残疾人'>残疾人</option>
						<option value='重点人员'>重点人员</option>
						<option value='两劳释放'>两劳释放</option>
						<option value='在押在教'>在押在教</option>
						<option value='社区矫正人员'>社区矫正人员</option>
						</select>
                    </div>
					
					<button id="btnSearch" type="button" class="btn btn-success" onclick="searchResident();">查询</button>
					
                  </div>
              </form>
			  
			  <div class="card-body">
                <table class="table table-bordered table-striped" id="dataTable">
                  <thead>
                  <tr>
                    <th style='text-align:center;'>姓名</th>
					<th style='text-align:center;'>居民特征</th>
					<th style='text-align:center;'>手机号</th>
					<th style='text-align:center;'>居住地</th>
                  </tr>
                  </thead>
				  <tbody></tbody>
                </table>
              </div>
			  
			  
            </div>
            <div class="modal-footer justify-content-between">
              <div>
              <button type="button" class="btn btn-default" onclick="javascript:addSelectedResident();">添加选中</button>
			  <button type="button" class="btn btn-primary" onclick="javascript:addAllResident();">添加全部</button>
			  </div>
              <button type="button" data-dismiss="modal" class="btn btn-primary">关闭</button>
            </div>
          </div>
          <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
      </div>
	  
	  
	  
	  <div class="modal fade" id="userDialog">
        <div class="modal-dialog">
          <div class="modal-content" style="width:1000px;">
            <div class="modal-header">
              <h4 class="modal-title">工作人员选择</h4>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              
			  <form class="form-horizontal">
                <!--div class="card-body"-->
                  <div class="form-group row">
                    <label for="inputEmail3" class="col-sm-1 col-form-label">姓名</label>
                    <div class="col-sm-2">
                      <input class="form-control" id="userNameQry">
                    </div>
					
					<button id="btnSearchUser" type="button" class="btn btn-success" onclick="searchUser();">查询</button>
					
                  </div>
              </form>
			  
			  <div class="card-body">
                <table class="table table-bordered table-striped" id="userDataTable">
                  <thead>
                  <tr>
                    <th style='text-align:center;'>姓名</th>
					<th style='text-align:center;'>角色</th>
					<th style='text-align:center;'>手机号</th>
					<th style='text-align:center;'>职务</th>
                  </tr>
                  </thead>
				  <tbody></tbody>
                </table>
              </div>
			  
			  
            </div>
            <div class="modal-footer justify-content-between">
              <button type="button" class="btn btn-default" onclick="javascript:addAllUser();">添加全部</button>
              <button type="button" data-dismiss="modal" class="btn btn-primary">关闭</button>
            </div>
          </div>
          <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
      </div>
	  
	  
    </section>
	
	
<script>

var uploaderaudio = WebUploader.create({
	auto: true,
// swf文件路径
//swf: BASE_URL + '/js/Uploader.swf',
// 文件接收服务端
server: getContextPath()+'/fileController/upload',
// 选择文件的按钮。可选。
// 内部根据当前运行是创建，可能是input元素，也可能是flash.
pick: '#audiopick',
formData:{
attributeName:'audio'
}
});

uploaderaudio.on( 'beforeFileQueued', function( file ) {
	
	debugger;

	
});
uploaderaudio.on( 'fileQueued', function( file ) {
	
	$('#'+file.source._refer[0].id+'table').append('<tr><td>'+file.name+'</td><td id='+file.id+'>等待上传...</td>'+
						"<td><button type='button' id='"+file.id+"Button' class='btn btn-success btn-xs' onclick='javascript:downloadAttach();return false;'><i class='fa fa-check'></i></button></td>"+
						'</tr>');
});
uploaderaudio.on( 'uploadSuccess', function( file,response ) {
	$( '#'+response.attributeName ).val(response.fileName+VALUE_SPLITTER+$('#'+response.attributeName ).val());
	console.log($( '#'+response.attributeName ).val());
	$( '#'+file.id ).text('已上传');
	$('#'+file.id+'Button').attr('onclick', onclick='javascript:downloadAttach("'+response.fileName+'");return false;');
});
uploaderaudio.on( 'uploadError', function( file,response ) {
});	


$.ajax({
  type: 'POST',
  url: getContextPath()+"/volunteerteamController/load",
  data: '',//JSON.stringify({id:'ofcommunity'}),
  contentType: "application/json",
  success:function(result){
			
		if(result.success)
		{
			$('#volunteerTeamQry').html('');
			var filterArr = [];
			
			filterArr[0] = "<option value=''></option>";				
			
			for(var i=0;i<result.list.length;i++)
			{
				var filter = result.list[i];
				
				filterArr[i+1] = "<option value='" + filter.id + "'>" + filter.name + "</option>";						
			}
			$('#volunteerTeamQry').html(filterArr.join(''));
		}
		else
		{
			jError("获取志愿者组织列表失败!",{
				VerticalPosition : 'center',
				HorizontalPosition : 'center'
			});
		}
	},
  dataType: "json"
});

$.ajax({
  type: 'POST',
  url: getContextPath()+"/partyorganizationController/load",
  data: '',//JSON.stringify({id:'ofcommunity'}),
  contentType: "application/json",
  success:function(result){
			
		if(result.success)
		{
			$('#partyOrganizationQry').html('');
			var filterArr = [];
			
			filterArr[0] = "<option value=''></option>";				
			
			for(var i=0;i<result.list.length;i++)
			{
				var filter = result.list[i];
				
				filterArr[i+1] = "<option value='" + filter.id + "'>" + filter.name + "</option>";						
			}
			$('#partyOrganizationQry').html(filterArr.join(''));
		}
		else
		{
			jError("获取党组织列表失败!",{
				VerticalPosition : 'center',
				HorizontalPosition : 'center'
			});
		}
	},
  dataType: "json"
});

  
var userList = null;

var lTotalCnt = 0;

var dataGridTable = null;

function searchResident()
{
	var residentName = $('#residentNameQry').val();
	var characteristics = $('#characterQry').val();
	
	lTotalCnt = 0;
			
	if(dataGridTable!=null){  
		dataGridTable.fnClearTable(0);  
	}
	
	dataGridTable = $("#dataTable").dataTable({	
		destroy: true,
		stateSave: false,
		iDisplayLength: 10,
		lengthChange: false,
		"paging": true,
		"lengthChange": false,
		"searching": false,
		"bProcessing" : true,  
		"aaSorting": [[ 0, "asc" ]],  
		"ordering": false,
		"info": true,
		"oLanguage": { 
					"sProcessing": "正在加载中......", 
					"sLengthMenu": "每页显示 _MENU_ 条记录", 
					"sZeroRecords": "对不起，查询不到相关数据！", 
					"sInfoEmpty":"",
					"sInfo": "当前显示 _START_ 到 _END_ 条，共 _TOTAL_ 条记录", 
					"sInfoFiltered": "数据表中共为 _MAX_ 条记录", 
					"sSearch": "搜索", 
					"oPaginate":  
					{ 
						"sFirst": "首页", 
						"sPrevious": "上一页", 
						"sNext": "下一页", 
						"sLast": "末页" 
					}
				}, //多语言配置					
		"autoWidth": false,
		"bServerSide" : true,
		"sAjaxSource" : getContextPath()+'/residentController/load',
		"fnServerParams" : function(aoData) {  
			aoData.push({  
				"name" : "statId",  
				"value" : "abc"
			});  
		},  
		"columns": [
					{
						"sClass": "text-center",
						"data": "id",
						"render": function (data, type, row, meta) {
							return '<input type="checkbox" name="resid" value="' + data + '"/>';
						},
					},
					{ 'data': 'name' ,'sClass':'text-center',
						mRender : function(data,type,full){
							return showData(aesDecrypt(full.name), 1);
						}
					},
					{ 'data': 'characteristics' ,'sClass':'text-center'},
					{ 'data': 'mobile' ,'sClass':'text-center',
						mRender : function(data,type,full){
							return showData(aesDecrypt(full.mobile), 2);
						}
					},
					{ 'data': 'address' ,'sClass':'text-center'}
				],
		columnDefs: [],
		"fnServerData" : function(sSource, aoData, fnCallback) {  
			$('#btnSearch').attr('disabled','disabled');
			
			$.ajax({
				"type" : 'get',  
				"url" : sSource,  
				"dataType" : "json",  
				"data" : {  
					aoData : JSON.stringify(aoData),
					totalCnt : lTotalCnt,
					name : residentName,
					characteristics : characteristics
				},
				"success" : function(resp) {
					$('#btnSearch').removeAttr('disabled');
					if(resp.success == true)
					{
						userList = resp.list;
					
						fnCallback(resp);
					
						lTotalCnt = resp.iTotalRecords;
					}
					else
					{
						jError("加载数据出错!",{
							VerticalPosition : 'center',
							HorizontalPosition : 'center'
						});
					}
				},
				"failure":function (result) {
					$('#btnSearch').removeAttr('disabled');
				}
			});  
		}
	});
	
}





function searchPartyMember()
{
	var name = $('#partyMemberQry').val();
	var of_partyorganization = $('#partyOrganizationQry').val();
	
	$.get(getContextPath()+'/jc_partymemberController/load?name='+name+'&of_partyorganization='+of_partyorganization,
	function(result){
		$('#btnSearchPartyMember').removeAttr('disabled');
		var obj = jQuery.parseJSON(result);  
		if(obj.success)
		{
			userList = obj.list;
			dataTable = $('#partyMemberDataTable').dataTable( {
				"processing": true,
				"bJQueryUI": false,
				"bFilter": false,
				"bStateSave":true,
				"bAutoWidth": false, //自适应宽度 
				iDisplayLength: 10,
				lengthChange: false,
				"bProcessing": true, 
				"bDestroy":true,
				"bSort": false, 
				"data":obj.list,
				"oLanguage": { 
					"sProcessing": "正在加载中......", 
					"sLengthMenu": "每页显示 _MENU_ 条记录", 
					"sZeroRecords": "对不起，查询不到相关数据！", 
					"sInfoEmpty":"",
					"sInfo": "当前显示 _START_ 到 _END_ 条，共 _TOTAL_ 条记录", 
					"sInfoFiltered": "数据表中共为 _MAX_ 条记录", 
					"sSearch": "搜索", 
					"oPaginate":  
					{ 
						"sFirst": "首页", 
						"sPrevious": "上一页", 
						"sNext": "下一页", 
						"sLast": "末页" 
					}
				}, //多语言配置					
				"columns": [{
						"sClass": "text-center",
						"data": "id",
						"render": function (data, type, row, meta) {
							return '<input type="checkbox" name="pmid" value="' + data + '"/>';
						},
					},
					{ 'data': 'name' ,'sClass':'text-center',
						mRender : function(data,type,full){
							return showData(aesDecrypt(full.name), 1);
						}
					},
					{ 'data': 'mobile' ,'sClass':'text-center',
						mRender : function(data,type,full){
							return showData(aesDecrypt(full.mobile), 1);
						}
					},
					{ 'data': 'of_partyorganizationname' ,'sClass':'text-center'}
				]
			} );
		}
	});
}

function addAllPartyMember()
{
	var mobileList = $('#mobileList').val();
	var realMobileList = $('#realMobileList').val();
	
	for(var i=0;i<userList.length;i++)
	{
		var phone = '', realphone = '';
		var name = '',realname = '';
		if(typeof(userList[i].mobile)!="undefined") {
			phone = showData(aesDecrypt(userList[i].mobile), 2);
			realphone = aesDecrypt(userList[i].mobile);
			
			name = showData(aesDecrypt(userList[i].name), 1);
			realname = aesDecrypt(userList[i].name);
		}
		if(mobileList == '') {
			mobileList = name + '-' + phone;
			realMobileList = realname+'-'+realphone;
		}
		else {
			mobileList += ", " +name +'-'+ phone;
			realMobileList +=", " +realname+'-'+ realphone;
		}
	}

	console.log(realMobileList);
	$('#mobileList').val(mobileList);
	$('#realMobileList').val(realMobileList);
}

function addSelectedPartyMember()
{
	var mobileList = $('#mobileList').val();
	var realMobileList = $('#realMobileList').val();
	
	$('input:checkbox[name=pmid]:checked').each(function (i) {
		var val = $(this).val();
		
		for(var i=0;i<userList.length;i++)
		{
			if(userList[i].id == val){
				var phone = '', realphone = '';
				if(typeof(userList[i].mobile)!="undefined") {
					phone = showData(aesDecrypt(userList[i].mobile), 2);
					realphone = aesDecrypt(userList[i].mobile);
					
					name = showData(aesDecrypt(userList[i].name), 1);
					realname = aesDecrypt(userList[i].name);
				}
				if(mobileList == '') {
					mobileList = name + '-' + phone;
					realMobileList = realname+'-'+realphone;
				}
				else {
					mobileList += ", " + name + '-' + phone;
					realMobileList +=", " +realname+'-'+ realphone;
				}
			}
		}
		
	});
	
	console.log(realMobileList);
	$('#mobileList').val(mobileList);
	 $('#realMobileList').val(realMobileList);
}


function searchVolunteer()
{
	var name = $('#volunteerQry').val();
	var of_volunteerteam = $('#volunteerTeamQry').val();
	
	$.get(getContextPath()+'/jc_volunteerController/load?name='+name+'&of_volunteerteam='+of_volunteerteam,
	function(result){
		var obj = jQuery.parseJSON(result);  
		if(obj.success)
		{
			userList = obj.list;
			dataTable = $('#volunteerDataTable').dataTable( {
				"processing": true,
				"bJQueryUI": false,
				"bFilter": false,
				"bStateSave":true,
				"bAutoWidth": false, //自适应宽度 
				iDisplayLength: 10,
				lengthChange: false,
				"bProcessing": true, 
				"bDestroy":true,
				"bSort": false, 
				"oLanguage": { 
					"sProcessing": "正在加载中......", 
					"sLengthMenu": "每页显示 _MENU_ 条记录", 
					"sZeroRecords": "对不起，查询不到相关数据！", 
					"sInfoEmpty":"",
					"sInfo": "当前显示 _START_ 到 _END_ 条，共 _TOTAL_ 条记录", 
					"sInfoFiltered": "数据表中共为 _MAX_ 条记录", 
					"sSearch": "搜索", 
					"oPaginate":  
					{ 
						"sFirst": "首页", 
						"sPrevious": "上一页", 
						"sNext": "下一页", 
						"sLast": "末页" 
					}
				}, //多语言配置					
				"data":obj.list,
				"columns": [{
						"sClass": "text-center",
						"data": "id",
						"render": function (data, type, row, meta) {
							return '<input type="checkbox" name="volid" value="' + data + '"/>';
						},
					},
					{ 'data': 'name' ,'sClass':'text-center',
						mRender : function(data,type,full){
							return showData(aesDecrypt(full.name), 1);
						}
					},
					{ 'data': 'mobile' ,'sClass':'text-center',
						mRender : function(data,type,full){
							return showData(aesDecrypt(full.mobile), 1);
						}
					},
					{ 'data': 'of_volunteerteam' ,'sClass':'text-center'}
				]
			} );
		}
	});
}

function addAllVolunteer()
{
	var mobileList = $('#mobileList').val();
	var realMobileList = $('#realMobileList').val();
	
	for(var i=0;i<userList.length;i++)
	{
		var phone = '', realphone = '';
		var name = '',realname = '';
		if(typeof(userList[i].mobile)!="undefined") {
			phone = showData(aesDecrypt(userList[i].mobile), 2);
			realphone = aesDecrypt(userList[i].mobile);
			
			name = showData(aesDecrypt(userList[i].name), 1);
			realname = aesDecrypt(userList[i].name);
		}
		if(mobileList == '') {
			mobileList = name + '-' + phone;
			realMobileList = realname+'-'+realphone;
		}
		else {
			mobileList += ", " +name +'-'+ phone;
			realMobileList +=", " +realname+'-'+ realphone;
		}
	}

	console.log(realMobileList);
	$('#mobileList').val(mobileList);
	$('#realMobileList').val(realMobileList);
}

function addSelectedVolunteer()
{
	var mobileList = $('#mobileList').val();
	var realMobileList = $('#realMobileList').val();
	
	$('input:checkbox[name=volid]:checked').each(function (i) {
		var val = $(this).val();
		for(var i=0;i<userList.length;i++)
		{
			if(userList[i].id == val){
				var phone = '', realphone = '';
				if(typeof(userList[i].mobile)!="undefined") {
					phone = showData(aesDecrypt(userList[i].mobile), 2);
					realphone = aesDecrypt(userList[i].mobile);
					
					name = showData(aesDecrypt(userList[i].name), 1);
					realname = aesDecrypt(userList[i].name);
				}
				if(mobileList == '') {
					mobileList = name + '-' + phone;
					realMobileList = realname+'-'+realphone;
				}
				else {
					mobileList += ", " + name + '-' + phone;
					realMobileList +=", " +realname+'-'+ realphone;
				}
			}
		}
		
	});
	
	console.log(realMobileList);
	$('#mobileList').val(mobileList);
	 $('#realMobileList').val(realMobileList);
}


function removeSelected()
{
	$('#mobileList').val('');
	$('#realMobileList').val('');
}



function searchUser()
{
	var userName = $('#userNameQry').val();
	//var characteristics = $('#characterQry').val();
	
	$.get(getContextPath()+'/sysUserController/load?name='+userName,
	function(result){
		$('#btnSearchUser').removeAttr('disabled');
		var obj = jQuery.parseJSON(result);  
		if(obj.success)
		{
			userList = obj.list;
			dataTable = $('#userDataTable').dataTable( {
				"processing": true,
				"bJQueryUI": false,
				"bFilter": false,
				"bStateSave":true,
				"bAutoWidth": false, //自适应宽度 
				iDisplayLength: 10,
				lengthChange: false,
				"bProcessing": true, 
				"bDestroy":true,
				"bSort": false, //是否使用排序 		
				"oLanguage": { 
					"sProcessing": "正在加载中......", 
					"sLengthMenu": "每页显示 _MENU_ 条记录", 
					"sZeroRecords": "对不起，查询不到相关数据！", 
					"sInfoEmpty":"",
					"sInfo": "当前显示 _START_ 到 _END_ 条，共 _TOTAL_ 条记录", 
					"sInfoFiltered": "数据表中共为 _MAX_ 条记录", 
					"sSearch": "搜索", 
					"oPaginate":  
					{ 
						"sFirst": "首页", 
						"sPrevious": "上一页", 
						"sNext": "下一页", 
						"sLast": "末页" 
					}
				}, //多语言配置					
				"data":obj.list,
				"columns": [
					{ 'data': 'name' ,'sClass':'text-center'},
					{ 'data': 'roleTxt' ,'sClass':'text-center'},
					{ 'data': 'mobile' ,'sClass':'text-center'},
					{ 'data': 'job' ,'sClass':'text-center'}
				],
				columnDefs: [
					/*{
					className: 'control',
					orderable: false,
					targets:  0,//从0开始
					mRender : function(data,type,full){
						var btn = "<a href=\"#\" onclick=\"selectUser('"+full.name+"','"+full.idnumber+"','"+full.mobile+"','"+full.address+"')\" data-toggle=\"tooltip\" title=\"查看\">"+full.name+"</a>";
						return btn;
					}
					}*/
				]
			} );
		}
	});
}

function addSelectedResident()
{
	var mobileList = $('#mobileList').val();
	var realMobileList = $('#realmobileList').val();
	
	/*
	var users = '';
	for(var i=0;i<userList.length;i++)
	{
		var user = userList[i].name+'-'+userList[i].mobile;
		
		mobileList += user+',';
	}
	*/
	$('input:checkbox[name=resid]:checked').each(function (i) {
		var val = $(this).val();
		for(var i=0;i<userList.length;i++)
		{
			if(userList[i].id == val){
				var phone = '', realphone = '';
				if(typeof(userList[i].mobile)!="undefined") {
					phone = showData(aesDecrypt(userList[i].mobile), 2);
					realphone = aesDecrypt(userList[i].mobile);
				}
				if(mobileList == '') {
					mobileList = phone;
					realMobileList = realphone;
				}
				else {
					mobileList += ", " + phone;
					realMobileList +=", " + realphone;
				}
			}
		}
		
	});
	
	console.log(realMobileList);
	$('#mobileList').val(mobileList);
	 $('#realmobileList').val(realMobileList);
}

function addAllResident()
{
	var mobileList = $('#mobileList').val();
	var realMobileList = $('#realmobileList').val();
	
	var residentName = $('#residentNameQry').val();
	var characteristicsArr = $('#characterQry').select2().val();	
	var characteristics = characteristicsArr.join(',');
	
	var mobileList = $('#mobileList').val();
	var realMobileList = $('#realMobileList').val();
	
	$.get(getContextPath()+'/residentController/load?name='+residentName+'&characteristics='+characteristics,
	function(result){
		$('#btnSearch').removeAttr('disabled');
		var obj = jQuery.parseJSON(result);  
		if(obj.success)
		{
			userList = obj.list;
			
			for(var i=0;i<userList.length;i++)
			{
				var phone = '', realphone = '';
				if(typeof(userList[i].mobile)!="undefined") {
					phone = showData(aesDecrypt(userList[i].mobile), 2);
					realphone = aesDecrypt(userList[i].mobile);
				}
				if(mobileList == '') {
					mobileList = phone;
					realMobileList = realphone;
				}
				else {
					mobileList += ", " + phone;
					realMobileList +=", " + realphone;
				}
			}
			
			console.log(realMobileList);
			$('#mobileList').val(mobileList);
			$('#realMobileList').val(realMobileList);
		}
	});
	
	
	/*
	$('input:checkbox[name=resid]:checked').each(function (i) {
		var val = $(this).val();
		for(var i=0;i<userList.length;i++)
		{
			if(userList[i].id == val){
				var phone = '', realphone = '';
				if(typeof(userList[i].mobile)!="undefined") {
					phone = showData(aesDecrypt(userList[i].mobile), 2);
					realphone = aesDecrypt(userList[i].mobile);
				}
				if(mobileList == '') {
					mobileList = phone;
					realMobileList = realphone;
				}
				else {
					mobileList += ", " + phone;
					realMobileList +=", " + realphone;
				}
			}
		}
		
	});
	
	console.log(realMobileList);
	$('#mobileList').val(mobileList);
	 $('#realmobileList').val(realMobileList);*/
}

function addAllUser()
{
	/*var mobileList = $('#target').val();
	
	var users = '';
	for(var i=0;i<userList.length;i++)
	{
		var user = userList[i].name+'-'+userList[i].mobile;
		
		mobileList += user+',';
	}
	
	$('#target').val(mobileList);*/
	
	var mobileList = $('#internalMobileList').val();
	
	var users = '';
	for(var i=0;i<userList.length;i++)
	{
		var user = userList[i].name+'-'+userList[i].mobile;
		
		mobileList += user+',';
	}
	
	$('#internalMobileList').val(mobileList);
}

</script>
