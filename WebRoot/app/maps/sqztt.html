
<!--script src="../plugins/ol5/ol.js">

<script type="text/javascript" src="./maps/include-web.js"></script>
<script type="text/javascript" src="../plugins/iclient/ol/include-ol.js"></script-->

	
	
	

    <!-- Content Header (Page header) -->
    <section class="content-header">
      <div class="container-fluid">
        <div class="row mb-2">
          <div class="col-sm-6">
            <h1>社区专题图</h1>
          </div>
           <!--div class="col-sm-6 pull-right">
				<form class="form-horizontal">
				
				<div class='form-group row pull-right' id="layerDiv">
				
				</div>
				</form>
				
			  </div-->
        </div>
      </div><!-- /.container-fluid -->
    </section>

    <!-- Main content -->
        <section class="content">
      <div class="container-fluid">
        <!-- Info boxes -->
        <div class="row">

			<div class="col-md-12">

				<div class="card">
			 
					<div class="card-body ">
			  
			  <a class="btn btn-app" id="xfdjtAnchor" >
					  <i> <img src="../../images/icon/gisicon/先锋党建图.png" width="32px"  alt="" /></i></br>
					  先锋党建图
					  </a>

					  <a class="btn btn-app" id="sqfftAnchor" >
						<i> <img src="../../images/icon/gisicon/社区服务图.png" width="32px"  alt="" /></i></br>
						社区服务图
						</a>
					
					<a class="btn btn-app" id="pajstAnchor" >
						<i> <img src="../../images/icon/gisicon/平安建设图.png" width="32px"  alt="" /></i></br>
						平安建设图
						</a>

					<a class="btn btn-app" id="wjtytAnchor" >
						<i> <img src="../../images/icon/gisicon/文教体育图.png" width="32px"  alt="" /></i></br>
						文教体育图
						</a>

						<a class="btn btn-app" id="hjwstAnchor" >
							<i> <img src="../../images/icon/gisicon/环境卫生图.png" width="32px"  alt="" /></i></br>
							环境卫生图
							</a>

				<a class="btn btn-app" id="fzbxAnchor" >
					<i> <img src="../../images/icon/gisicon/防灾避险图.png" width="32px"  alt="" /></i></br>
					防灾避险图
					</a>

					<a class="btn btn-app" id="fzbxtAnchor" >
						<i> <img src="../../images/icon/gisicon/重点人员图.png" width="32px"  alt="" /></i></br>
						重点人员图
						</a>
  
						<a class="btn btn-app" id="hzhztAnchor" >
						  <i> <img src="../../images/icon/gisicon/河长湖长图.png" width="32px"  alt="" /></i></br>
						  河长湖长图
						  </a>
					  
					  <a class="btn btn-app" id="jzxztAnchor" >
						  <i> <img src="../../images/icon/gisicon/街长巷长图.png" width="32px"  alt="" /></i></br>
						  街长巷长图
						  </a>
  
					  <a class="btn btn-app" id="xczdtAnchor" >
						  <i> <img src="../../images/icon/gisicon/宣传阵地图.png" width="32px"  alt="" /></i></br>
						  宣传阵地图
						  </a>


					  <a class="btn btn-app" id="csgltAnchor" >
						<i> <img src="../../images/icon/gisicon/城市管理图.png" width="32px"  alt="" /></i></br>
						城市管理图
						</a>

						<a class="btn btn-app" id="tczytAnchor" >
							<i> <img src="../../images/icon/gisicon/停车资源图.png" width="32px"  alt="" /></i></br>
							停车资源图
							</a>

						<a class="btn btn-app" id="sxsqtAnchor" >
								<i> <img src="../../images/icon/gisicon/事项社情图.png" width="32px"  alt="" /></i></br>
							事项社情图
								</a>
    


		</div>
		

        <!-- /.row -->
      </div><!--/. container-fluid -->
    </section>
	
	
	  <section class="content">
      <div class="container-fluid">
        <div class="row">
          <div class="col-md-12">
            <!-- AREA CHART -->
            <div class="card card-primary">
              <div class="card-header">
                <h3 class="card-title" id="mapTitle">社区专题图</h3>

                
                  <!--button type="button" class="btn btn-tool" data-card-widget="collapse"><i class="fas fa-minus"></i>
                  </button>
                  <button type="button" class="btn btn-tool" data-card-widget="remove"><i class="fas fa-times"></i></button-->
                
              </div>
         	 <div class="card-body" id="sqzttDiv" style="height:700px;">
			 
				<img src="../images/label.png" style="position:absolute; right: 15px; top:65px; z-index:1000;" id="labelimg" onclick="showlayerlabel();"/>
				<img src="../images/layer.png" style="position:absolute; right: 15px; top:105px; z-index:1000;" onclick="showlayer();"/>
				<div id="layerDiv" style="position: absolute; z-index: 999; right: 15px; top: 105px; width: 150px; background-color:#d0d0d0; opacity:0.8; display:none; border-radius:5px;">
					<ul id="main_checkbox" style="padding-top:10px;">
					
					</ul>
				</div>
              </div>
              <!-- /.card-body -->
            </div>
            <!-- /.card -->

  

          </div>
     
          <!-- /.col (RIGHT) -->
        </div>
        <!-- /.row -->
      </div><!-- /.container-fluid -->
    </section>

<!-- ChartJS>
<script src="./plugins/chart.js/Chart.min.js"></script -->


<style>
      .map {
        width: 100%;
        height:400px;
      }
      .ol-popup {
        position: absolute;
        background-color: white;
        box-shadow: 0 1px 4px rgba(0,0,0,0.2);
        padding: 15px;
        border-radius: 10px;
        border: 1px solid #cccccc;
        bottom: 12px;
        left: -50px;
        min-width: 280px;
      }
      .ol-popup:after, .ol-popup:before {
        top: 100%;
        border: solid transparent;
        content: " ";
        height: 0;
        width: 0;
        position: absolute;
        pointer-events: none;
      }
      .ol-popup:after {
        border-top-color: white;
        border-width: 10px;
        left: 48px;
        margin-left: -10px;
      }
      .ol-popup:before {
        border-top-color: #cccccc;
        border-width: 11px;
        left: 48px;
        margin-left: -11px;
      }
      .ol-popup-closer {
        text-decoration: none;
        position: absolute;
        top: 2px;
        right: 8px;
      }
      .ol-popup-closer:after {
        content: "✖";
      }
    </style>
	
	
<!-- ChartJS>
<script src="./plugins/chart.js/Chart.min.js"></script -->

<div id="popup" class="ol-popup">
      <a href="#" id="popup-closer" class="ol-popup-closer"></a>
      <div id="popup-content"></div>
    </div>

<!-- page script -->
<script>

var curMap = '';
var baseLayer = null;
var dataLayer = null;

var labelshow = true; //默认显示label

var layerStyleMap = {};

function loadMap(mapName)
{
	curMap = 'mapName';
	
	dataLayer.getSource().clear();
	
	$.get(getContextPath()+"/gismapController/getMapByName?name="+mapName,
			function(response)
			{	
				var respObj = jQuery.parseJSON(response); 

				var geoServerURL = respObj.mapurl;
				
				$('#layerDiv').show();
				$('#main_checkbox').hide();
				$('#main_checkbox').empty();	
				
				for(var i=0;i<respObj.list.length;i++)
				{
					var layer = respObj.list[i];
					
					var layerName = layer.layersource;
					
					var layerId = layer.id;
					
					var checkboxWidth = layer.note.length * 22;
					//图层列表
					var layerCtl = '<li><input class="form-check-input" type="checkbox" name="layer" id="'+layerId+'" checked>' + 
                          '<label class="form-check-label" style="color:black; font-size:12px;">'+layer.note+'</label></li>';
					
					$('#main_checkbox').append(layerCtl);
					
					var layerType = layer.layertype;
					
					var layerStyle = layer.layerstyle;
					
					var layerStyleObj = jQuery.parseJSON(layerStyle); 
					
					//[{"type": "上水井盖","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0101_ssjg.png"}},{"type": "污水井盖","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0102_wsjg.png"}},{"type": "雨水井盖","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0103_ysjg.png"}},{"type": "雨水箅子","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0104_ysbz.png"}},{"type": "电力井盖","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0105_dljg.png"}},{"type": "路灯井盖","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0106_ldjg.png"}},{"type": "通信井盖","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0107_txjg.png"}},{"type": "电视井盖","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0108_dsjg.png"}},{"type": "网络井盖","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0109_wljg.png"}},{"type": "热力井盖","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0110_rljg.png"}},{"type": "燃气井盖","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0111_rqjg.png"}},{"type": "公安井盖","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0112_gajg.png"}},{"type": "消防设施","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0113_xfss.png"}},{"type": "园林井盖","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0114_yljg.png"}},{"type": "信号灯电源井盖","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0115_xhddyjg.png"}},{"type": "邮政井盖","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0116_yzjg.png"}},{"type": "电缆井盖","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0117_dlanjg.png"}},{"type": "化粪池井盖","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0118_hfcjg.png"}},{"type": "中水井盖","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0119_zsjg.png"}},{"type": "公交井盖","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0120_gjjg.png"}},{"type": "输油（气）井盖","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0121_syqjg.png"}},{"type": "特殊井盖","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0122_tsjg.png"}},{"type": "不明井盖","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0123_bmjg.png"}},{"type": "水井","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0124_sj.png"}},{"type": "供水器","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0125_gsq.png"}},{"type": "沟槽厕所盖板","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0126_gccsgb.png"}},{"type": "通信交接箱","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0127_txjjx.png"}},{"type": "电力设施","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0128_dlss.png"}},{"type": "电力设施标识牌","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0129_dlssbsp.png"}},{"type": "电力立杆","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0130_dllg.png"}},{"type": "通信立杆","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0131_txlg.png"}},{"type": "公交立杆","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0132_gjlg.png"}},{"type": "特殊立杆","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0133_tslg.png"}},{"type": "不明立杆","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0134_bmlg.png"}},{"type": "旗杆","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0135_qg.png"}},{"type": "输油（气）标志","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0136_syqbz.png"}},{"type": "路灯","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0137_ld.png"}},{"type": "地灯","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0138_dd.png"}},{"type": "景观灯","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0139_jgd.png"}},{"type": "报刊亭","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0140_bkt.png"}},{"type": "电话亭","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0141_dht.png"}},{"type": "邮筒","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0142_yt.png"}},{"type": "信息亭","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0143_xxt.png"}},{"type": "售货亭","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0144_sht.png"}},{"type": "自动售货机","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0145_zdshj.png"}},{"type": "户外健身设施","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0146_hwjsss.png"}},{"type": "高压线铁塔","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0147_gyxtt.png"}},{"type": "变压器（箱）","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0148_byqx.png"}},{"type": "燃气调压站（箱）","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0149_rqdyzx.png"}},{"type": "监控电子眼","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0150_jkdzy.png"}},{"type": "治安岗亭","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0151_zagt.png"}},{"type": "休息亭","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0152_xxit.png"}},{"type": "自助缴费机","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0153_zzjfj.png"}},{"type": "充电桩","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0154_cdz.png"}},{"type": "防蚊闸","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0155_fwz.png"}},{"type": "跨河管道","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0156_khgd.png"}},{"type": "露天燃气管道","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0157_ltrqgd.png"}},{"type": "晒衣架","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0158_syj.png"}},{"type": "停车场","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0201_tcc.png"}},{"type": "立体车库","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0202_ltck.png"}},{"type": "停车咪表","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0203_tcmb.png"}},{"type": "公交站亭","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0204_gjzt.png"}},{"type": "出租车站牌","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0205_czczp.png"}},{"type": "过街天桥","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0206_gjtq.png"}},{"type": "地下通道","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0207_dxtd.png"}},{"type": "立交桥","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0208_ljq.png"}},{"type": "跨河桥","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0209_khq.png"}},{"type": "交通标志牌","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0210_jtbzp.png"}},{"type": "限高架标志","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0211_xgjbz.png"}},{"type": "路名牌","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0212_lmp.png"}},{"type": "地名牌","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0213_dmp.png"}},{"type": "交通信号灯","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0214_jtxhd.png"}},{"type": "交通信号设施","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0215_jtxhss.png"}},{"type": "交通岗亭","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0216_jtgt.png"}},{"type": "交通护栏","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0217_jthl.png"}},{"type": "防撞桶","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0218_fzt.png"}},{"type": "安全岛","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0219_aqd.png"}},{"type": "人行横道桩","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0220_rxhdz.png"}},{"type": "便道桩","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0221_bdz.png"}},{"type": "柔性隔离体","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0222_rxglt.png"}},{"type": "道路信息显示屏","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0223_dlxxxsp.png"}},{"type": "道路隔音屏","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0224_dlgyp.png"}},{"type": "非机动车停放点","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0225_fjdctfd.png"}},{"type": "自行车租赁点","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0226_zxczld.png"}},{"type": "存车支架","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0227_cczj.png"}},{"type": "铁道口设施","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0228_tdkss.png"}},{"type": "栈桥","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0229_zq1.png"}},{"type": "水域标示牌","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0230_sybsp.png"}},{"type": "港监设施","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0231_gjss.png"}},{"type": "公共厕所","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0301_ggcs.png"}},{"type": "公厕指示牌","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0302_gczsp.png"}},{"type": "化粪池","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0303_hfc.png"}},{"type": "垃圾间（楼）","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0304_ljjl.png"}},{"type": "垃圾箱","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0305_ljx.png"}},{"type": "户外广告","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0306_hwgg.png"}},{"type": "牌匾标识","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0307_pbbs.png"}},{"type": "宣传栏","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0308_xcl.png"}},{"type": "气象监测站","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0309_qxjcz.png"}},{"type": "环保监测站","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0310_hbjcz.png"}},{"type": "污水口监测站","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0311_wskjcz.png"}},{"type": "污水监测器","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0312_wsjcq.png"}},{"type": "噪声显示屏","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0313_zsxsp.png"}},{"type": "古树名木","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0401_gsmm.png"}},{"type": "行树","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0402_xs.png"}},{"type": "独立树","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0403_dls.png"}},{"type": "护树设施","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0404_hsss.png"}},{"type": "花架花钵","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0405_hjhb.png"}},{"type": "雕塑","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0406_ds.png"}},{"type": "街头坐椅","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0407_jtzy.png"}},{"type": "绿地护栏","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0408_ldhl.png"}},{"type": "绿地附属设施","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0409_ldfsss.png"}},{"type": "喷泉","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0410_pq.png"}},{"type": "人防工事","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0501_rfgs.png"}},{"type": "公房地下室","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0502_gfdxs.png"}},{"type": "车辆加油（气、电）站","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0503_cljyqdz.png"}},{"type": "液化气站","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0504_yhqz.png"}},{"type": "重大危险源","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0505_zdwxy.png"}},{"type": "水域附属设施","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0506_syfsss.png"}},{"type": "水域护栏","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0507_syhl.png"}},{"type": "防汛墙","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0508_fxq.png"}},{"type": "文物古迹","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0509_wwgj.png"}},{"type": "兴趣点","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0605_xqd.png"}},{"type": "门牌号","style": {"iconurl": "gisicon/jc_publicfacilities/bj_0606_mph.png"}}]
					layerStyleMap[layerId] = layerStyleObj;
					
					if(layerId == 'layer2_5'||layerId == 'layer4_3'||layerId == 'layer3_5'||layerId == 'layer4_2'||layerId == 'layer6_2'
						||layerId == 'layer13_7'||layerId == 'layer5_2')
					{
						for(var k=0;k<layerStyleObj.length;k++)
						{
							layerStyleMap[layerStyleObj[k].type] = layerStyleObj[k].style;
						}
					}
					
					$.ajax({
						type: "GET",
						url: getContextPath()+"/dataController/wfs?layerIds="+layerId,
						contentType: "application/json; charset=utf-8",
						dataType: "json",
						success: function (dataList) {
						
							for(var p=0;dataList.features != null && p < dataList.features.length;p++)
							{
								var data = dataList.features[p];
								
								var layerId = data.layerId;
								
								layerStyleObj = layerStyleMap[layerId];
								
								if(data.type == 'MultiLineString')
								{
									var iconFeature = new ol.Feature({
										geometry: new ol.geom.MultiLineString(data.coordinates),
										weight:1,
										population: 4000,
										rainfall: 500
									});
									
									iconFeature.setId(data.id);
									
									dataLayer.getSource().addFeature(iconFeature);	
								}
								else if(data.type == 'Point')
								{
									/*var iconFeature = new ol.Feature({
										geometry: new ol.geom.Point(data.coordinates),
										weight:1,
										population: 4000,
										rainfall: 500
									});
									
									iconFeature.setId(data.id);
									dataLayer.getSource().addFeature(iconFeature);	
									*/
									var iconFeature = new ol.Feature({
										geometry: new ol.geom.Point(data.coordinates),//(["116.37970237","39.83650525"]),//(data.coordinates),//			
										weight:1,
										population: 4000,
										rainfall: 500
									});
									
									var iconurl = '';
									if(layerStyleObj.style != null)
										iconurl = layerStyleObj.style.iconurl;
										
									if(layerId == 'layer2_5'||layerId == 'layer4_3'||layerId == 'layer3_5'||layerId == 'layer4_2'||layerId == 'layer6_2'
										||layerId == 'layer13_7'||layerId == 'layer5_2')
									{
										if(layerStyleMap[data.facilitytype] == null)
										{
											//console.log('icon for '+data.facilitytype+' not found for layerId:'+layerId+'.');
											continue;
										}
										iconurl = layerStyleMap[data.facilitytype].iconurl;
									}
									
									//console.log("http://localhost:8080"+getContextPath()+"/fileController/downloadIcon?fileName="+iconurl);
									
									iconFeature.setStyle(new ol.style.Style({
										image: new ol.style.Icon({
											src: getContextPath()+"/fileController/downloadIcon?fileName="+iconurl//'../icons/point.png'
										}),
										text: new ol.style.Text({
											font: '12px Calibri,sans-serif',fill: new ol.style.Fill({ color: '#000' }),stroke: new ol.style.Stroke({
											  color: '#fff',width: 2
											}),// get the text from the feature - `this` is ol.Feature
											// and show only under certain resolution
											text: data.info
										  })
									}));
									
									iconFeature.setId(data.id);
									dataLayer.getSource().addFeature(iconFeature);	
								}
								else if(data.type == 'MultiPolygon')
								{
									var pointArr = data.coordinates;
									
									/*var transferedArr = [];//data.coordinates;
									
									for(var q=0;q<pointArr.length;q++)
									{
										transferedArr[q] = ol.proj.transform(pointArr[q], 'EPSG:4326', 'EPSG:3857');
									}*/
									
									var iconFeature = new ol.Feature({
										geometry: new ol.geom.Polygon(data.coordinates),
										weight:1,
										population: 4000,
										rainfall: 500
									});
									//iconFeature.setId(data.info);
									iconFeature.setId(data.id);
									iconFeature.set('info', data.info);
									
									
									var strokeColor = '#1E90FF';
									if(layerStyleObj.style != null)
										strokeColor = layerStyleObj.style['stroke-color'];
										
									var strokeWidth = 1; 
									if(layerStyleObj.style != null)
										strokeWidth = layerStyleObj.style['stroke-width'];
									
									iconFeature.setStyle(new ol.style.Style({
										stroke: new ol.style.Stroke({       // 线样式
											color: strokeColor,
											width: strokeWidth
										}),
										fill: new ol.style.Fill({           // 填充样式
											color: layerStyleObj.style['fill-color-rgb'],
											opacity: layerStyleObj.style['fill-opacity']
										}),
										text: new ol.style.Text({
											font: '12px Calibri,sans-serif',fill: new ol.style.Fill({ color: '#000' }),stroke: new ol.style.Stroke({
											  color: '#fff',width: 2
											}),// get the text from the feature - `this` is ol.Feature
											// and show only under certain resolution
											text: data.info
										  })
									}));
									
									dataLayer.getSource().addFeature(iconFeature);	
								}
							}
						}
					});
				}
				
				var height = respObj.list.length * 25;
				$('#main_checkbox').css("height", height +"px");
				
				
				$("input[name='layer']").change(function() {
					reloadlayer();
				});
				
			}
	);
}

function editData(gid)
{
	var arr=new Array();
	arr = gid.split('.');
	curId = arr[1];
	var arr2 = new Array();
	arr2 = arr[0].split('_');
	var url = './jcsqsj/' + arr2[1] + '/' + arr2[1] + 'Detail.html';
	
	$('#main-content').load(url, function () {
		
    });
}

function mingqing(id)
{
	curId = id;
	$('#main-content').load("./jcsqsj/residebuilding/residebuildingMinqing.html", function () {
		
    });
}

function reloadlayer(){
	var checkedLayerId = '';
					
	$("input[name='layer']").each(function () {
		
		if($(this).prop('checked'))
			checkedLayerId += $(this).attr('id')+',';
	});
	
	
	$.ajax({
		type: "GET",
		//url:"http://49.233.26.198:8082/gis/zhsq/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=zhsq:jc_community&maxFeatures=50&outputFormat=application/json",
		url: getContextPath()+"/dataController/wfs?layerIds="+checkedLayerId,
		contentType: "application/json; charset=utf-8",
		dataType: "json",
		success: function (dataList) {
			
			dataLayer.getSource().clear();
			
			for(var p=0;dataList.features != null && p < dataList.features.length;p++)
			{
				var data = dataList.features[p];
				
				layerStyleObj = layerStyleMap[data.layerId];
				
				if(data.type == 'MultiLineString')
				{
					var iconFeature = new ol.Feature({
						geometry: new ol.geom.MultiLineString(data.coordinates),
						weight:1,
						population: 4000,
						rainfall: 500
					});
					
					iconFeature.setId(data.id);
					
					dataLayer.getSource().addFeature(iconFeature);	
				}
				else if(data.type == 'Point')
				{
					/*var iconFeature = new ol.Feature({
						geometry: new ol.geom.Point(data.coordinates),
						weight:1,
						population: 4000,
						rainfall: 500
					});
					
					iconFeature.setId(data.id);
					dataLayer.getSource().addFeature(iconFeature);	
					*/
					
					var iconFeature = new ol.Feature({
						geometry: new ol.geom.Point(data.coordinates),			
						weight:1,
						population: 4000,
						rainfall: 500
					});
					
					
					var iconurl = '';
					if(layerStyleObj.style != null)
						iconurl = layerStyleObj.style.iconurl;
						
					if(data.layerId == 'layer2_5'||data.layerId == 'layer4_3'||layerId == 'layer3_5'||layerId == 'layer4_2'||layerId == 'layer6_2'
						||layerId == 'layer13_7'||layerId == 'layer5_2')
						iconurl = layerStyleMap[data.facilitytype].iconurl;
					
					console.log(iconurl);
					
					if(showlabel){
						iconFeature.setStyle(new ol.style.Style({
							image: new ol.style.Icon({
								src: getContextPath()+"/fileController/downloadIcon?fileName="+iconurl//'../icons/point.png'
							}),
							text: new ol.style.Text({
								font: '12px Calibri,sans-serif',fill: new ol.style.Fill({ color: '#000' }),stroke: new ol.style.Stroke({
								  color: '#fff',width: 2
								}),// get the text from the feature - `this` is ol.Feature
								// and show only under certain resolution
								text: data.info
							  })
						}));
					}
					else {
						iconFeature.setStyle(new ol.style.Style({
							image: new ol.style.Icon({
								src: getContextPath()+"/fileController/downloadIcon?fileName="+iconurl//'../icons/point.png'
							})
						}));
					}
					
					
					iconFeature.setId(data.id);
					dataLayer.getSource().addFeature(iconFeature);	
				}
				else if(data.type == 'MultiPolygon')
				{
					var pointArr = data.coordinates;
					
					var iconFeature = new ol.Feature({
						geometry: new ol.geom.Polygon(data.coordinates),
						weight:1,
						population: 4000,
						rainfall: 500
					});
					//iconFeature.setId(data.info);
					iconFeature.setId(data.id);
					iconFeature.set('info', data.info);
					
					var strokeColor = '#1E90FF';
					if(layerStyleObj.style != null)
						strokeColor = layerStyleObj.style['stroke-color'];
						
					var strokeWidth = 1; 
					if(layerStyleObj.style != null)
						strokeWidth = layerStyleObj.style['stroke-width'];
					
					
					if(showlabel){
						iconFeature.setStyle(new ol.style.Style({
							stroke: new ol.style.Stroke({       // 线样式
								color: strokeColor,
								width: strokeWidth
							}),
							fill: new ol.style.Fill({           // 填充样式
								color: layerStyleObj.style['fill-color-rgb'],
								opacity: layerStyleObj.style['fill-opacity']
							}),
							text: new ol.style.Text({
								font: '12px Calibri,sans-serif',fill: new ol.style.Fill({ color: '#000' }),stroke: new ol.style.Stroke({
								  color: '#fff',width: 2
								}),// get the text from the feature - `this` is ol.Feature
								// and show only under certain resolution
								text: data.info
							  })
						}));
					}
					else {
						iconFeature.setStyle(new ol.style.Style({
							stroke: new ol.style.Stroke({       // 线样式
								color: strokeColor,
								width: strokeWidth
							}),
							fill: new ol.style.Fill({           // 填充样式
								color: layerStyleObj.style['fill-color-rgb'],//'orange'
								opacity: layerStyleObj.style['fill-opacity']
							})
						}));
					}
					
					dataLayer.getSource().addFeature(iconFeature);	
				}
			}
		}
	});
}

$(function () 
{
	$('#sxsqtAnchor').click(function () {
        loadMap('事项社情图');
    });
	
	$('#tczytAnchor').click(function () {
        loadMap('停车资源图');
    });
	
	$('#csgltAnchor').click(function () {
        loadMap('城市管理图');
    });
	
	$('#xczdtAnchor').click(function () {
        loadMap('宣传阵地图');
    });
	
	$('#jzxztAnchor').click(function () {
        loadMap('街长巷长图');
    });
	
	$('#hzhztAnchor').click(function () {
        loadMap('河长湖长图');
    });
	
	$('#zdryAnchor').click(function () {
        loadMap('重点人员图');
    });
	
	$('#fzbxtAnchor').click(function () {
        loadMap('防灾避险图');
    });
	
	$('#hjwstAnchor').click(function () {
        loadMap('环境卫生图');
    });
	
	$('#wjtytAnchor').click(function () {
        loadMap('文教体育图');
    });
	
	$('#pajstAnchor').click(function () {
        loadMap('平安建设图');
    });
	
	$('#sqfftAnchor').click(function () {
        loadMap('社区服务图');
    });
	
	$('#xfdjtAnchor').click(function () {
        loadMap('先锋党建图');
    });
	
	var container = document.getElementById('popup');
	var content = document.getElementById('popup-content');
	var closer = document.getElementById('popup-closer');

	/**
	 * Add a click handler to hide the popup.
	 * @return {boolean} Don't follow the href.
	 */
	closer.onclick = function() {
	  overlay.setPosition(undefined);
	  closer.blur();
	  return false;
	};


	/**
	 * Create an overlay to anchor the popup to the map.
	 */
	var overlay = new ol.Overlay({
	  element: container,
	  autoPan: true,
	  autoPanAnimation: {
		duration: 250
	  }
	});
	
	var map = new ol.Map({
		overlays: [overlay],
        target: 'sqzttDiv',
        view: new ol.View({
			//center: ol.proj.transform([116.30454,39.849639], 'EPSG:4326', 'EPSG:3857'),
			center: [116.30446673697033,39.883412379248995],
            zoom: 12,
			//projection: 'EPSG:3857',// 
			projection: 'EPSG:4326',// 
            multiWorld: true
        })/*,
        overlays: [overlay]*/
    });
    
	var baseLayer = new ol.layer.Tile({
        source: new ol.source.TileSuperMapRest({
            //url: "http://219.143.76.46:8089/iserver/services/map-agscache-fengtai/rest/maps/fengtai"
			url: "http://219.143.76.46:8089/iserver/services/map-tianditu/rest/maps/矢量底图_经纬度"
        })
    });
    map.addLayer(baseLayer);
	
	var baseLabelLayer = new ol.layer.Tile({
        source: new ol.source.TileSuperMapRest({
            //url: "http://219.143.76.46:8089/iserver/services/map-agscache-fengtai/rest/maps/fengtai"
			url: "http://219.143.76.46:8089/iserver/services/map-tianditu/rest/maps/矢量中文注记_经纬度"
        })
    });
    map.addLayer(baseLabelLayer);
	
	var dataSource = new ol.source.Vector();								
	dataLayer = new ol.layer.Vector({
		source: dataSource/*,
		style: new ol.style.Style({
                stroke: new ol.style.Stroke({
                    color: 'red',
                    width: 3
                }),
                fill: new ol.style.Fill({
                    color: 'rgba(0, 0, 255, 0.1)'
                })
            })*/
	});
	
	map.addLayer(dataLayer);
	
	map.on('singleclick', function(evt) 
	{
		var feature = map.forEachFeatureAtPixel(evt.pixel,
			function(feature) {
			
				return feature;
		});
		
		if(feature != null && feature != undefined)
		{
			var gid = feature.getId();
	
			console.log("info: " + feature.get('info'));
			
			//curId = gid.substring(gid.indexOf('\.')+1);
			
			var coordinate = evt.coordinate;
			//var hdms = toStringHDMS(toLonLat(coordinate));
			
			var arr=new Array();
			arr = gid.split('.');

			if(gid.indexOf('jc_residebuilding') >= 0){
								content.innerHTML = '<p>信息:</p><p>' + feature.get('info') +
				  '</p>' + '<button id="btnSearch" class="btn btn-success" style="margin-left:15px; float:right;" onclick="editData(\'' + gid + '\')">详情</button>' + '<button id="btnSearch" class="btn btn-info" style="margin-left:15px; float:right;" onclick="mingqing(\'' + arr[1] + '\')">民情图</button>';
			}
			else {
				content.innerHTML = '<p>信息:</p><p>' + feature.get('info') +
				  '</p>' + '<button id="btnSearch" class="btn btn-success" style="margin-left:15px; float:right;" onclick="editData(\'' + gid + '\')">详情</button>';
			  }
			overlay.setPosition(coordinate);
		
		}
	});
	
})

function showlayer(){
	if($("#main_checkbox").is(":hidden")){
		$("#main_checkbox").show();
	}
	else {
		$("#main_checkbox").hide();
	}
}

function showlayerlabel(){	
	if(showlabel == true){
		showlabel = false;
	}
	else {
		showlabel = true;
	}
	if(showlabel == true){
		$('#labelimg').attr("src", "../images/label.png");
	}
	else {
		$('#labelimg').attr("src", "../images/label2.png");
	}
	console.log("showlabel:" + showlabel);
	reloadlayer();
}
</script>
</body>
</html>
