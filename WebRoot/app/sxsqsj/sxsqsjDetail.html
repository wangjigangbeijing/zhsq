
		<script src="./sxsqsj/sxsqsjDetail.js"></script>
		
		<section class="content-header">
      <div class="container-fluid">
        <div class="row mb-2">
          <div class="col-sm-6">
            <h1>事项社情数据清单</h1>
          </div>
          <div class="col-sm-6">
            <ol class="breadcrumb float-sm-right">
              <li class="breadcrumb-item"><a href="#">清单列表</a></li>
              <li class="breadcrumb-item active">新增清单</li>
            </ol>
          </div>
        </div>
      </div>
    </section>

    

    <section class="content">
      <div class="container-fluid">
        <div class="row">
          <div class="col-12">
			 <div class="card">
              <div class="card card-info">
              <form class="form-horizontal">
                <div class="card-body">
				
                  <!--div class="form-group row">
                    <label for="inputEmail3" class="col-sm-2 col-form-label">事项编码</label>
                    <div class="col-sm-4">
                      <input type="text" class="form-control" id="sxbm">
                    </div>                  
                  </div-->
				  
				  <div class="form-group row">
                    <label for="inputEmail3" class="col-sm-2 col-form-label">事项名称</label>
                    <div class="col-sm-4">
                      <input type="text" class="form-control" id="sxmc">
                    </div>
                  </div>
				  
				  <div class="form-group row">
                    <label for="inputEmail3" class="col-sm-2 col-form-label">事项大类</label>
                    <div class="col-sm-4">
						<input type="text" class="form-control" id="sxdl" readonly>
                    </div>
                  </div>
				  				  
				  <div class="form-group row">
                    <label for="inputEmail3" class="col-sm-2 col-form-label">事项小类</label>
                    <div class="col-sm-4">
                      <select class="form-control m-bot15" id="sxxl">
					  </select>
                    </div>
                  </div>
				  
				  <div class="form-group row">
                    <label for="inputPassword3" class="col-sm-2 col-form-label">事项详情</label>
                    <div class="col-sm-9">
					  <textarea class="form-control" name="gzzz" rows="6" id="sxxq"></textarea>
                    </div>
                  </div>  
				  				  
				  <div class="form-group row">
                    <label for="inputEmail3" class="col-sm-2 col-form-label">事项地点</label>
                    <div class="col-sm-4">
                      <input type="text" class="form-control" id="sxdd">
                    </div>
                  </div>
				  				  
				  <div class="form-group row">
                    <label for="inputEmail3" class="col-sm-2 col-form-label">事项当事人</label>
                    <div class="col-sm-4">
                      <input type="text" class="form-control" id="sxdsrname" readonly>
					  <input type="text" class="form-control" id="sxdsr" style="display:none;">
                    </div>
					<div class='col-md-3' id="selectResidentDiv">
						<button class="btn btn-default" type="button" data-toggle="modal" data-target="#residentDialog">选择</button>
						
					</div>
                  </div>
				  
				  <div class="form-group row">
                    <label for="inputEmail3" class="col-sm-2 col-form-label">事项经办人</label>
                    <div class="col-sm-4">
                      <input type="text" class="form-control" id="sxjbrname" readonly>
					  <input type="text" class="form-control" id="sxjbr" style="display:none;">
                    </div>
					<div class='col-md-3' id="selectUserDiv">
						<button class="btn btn-default" type="button" data-toggle="modal" data-target="#userDialog">选择</button>
						
					</div>
                  </div>
				  				  
				  
				   <div class="form-group row">
                    <label for="inputEmail3" class="col-sm-2 col-form-label">事项开始时间</label>
                    <div class="col-sm-4">						
						<div class="input-group-append" data-target="#sxkssj" data-toggle="datetimepicker">
							<input type="text" class="form-control datetimepicker-input" id="sxkssj">
							<div class="input-group-text"><i class="fa fa-calendar"></i></div>
						</div>						
                    </div>
                  </div>
				  
				   <div class="form-group row">
                    <label for="inputEmail3" class="col-sm-2 col-form-label">事项结束时间</label>
                    <div class="col-sm-4">						
						<div class="input-group-append" data-target="#sxjssj" data-toggle="datetimepicker">
							<input type="text" class="form-control datetimepicker-input" id="sxjssj">
							<div class="input-group-text"><i class="fa fa-calendar"></i></div>
						</div>						
                    </div>
                  </div>
				  
				  <div class="form-group row">
                    <label for="inputPassword3" class="col-sm-2 col-form-label">事项总结</label>
                    <div class="col-sm-9">
					  <textarea class="form-control" name="gzzz" rows="6" id="sxzj"></textarea>
                    </div>
                  </div>  
				  
				  <div class='form-group row'>
						<label class='col-md-2 control-label'>附件</label>
  				<div class='col-md-9'>
<div id='picturesdiv' class='wu-example'>
<input type='text' class='form-control field' name='pictures' id='pictures' style='display:none;'>
<table class='table' id='picturespicktable'><thead><tr><th>名称</th><th>状态</th><th>操作</th></tr></thead><tbody></tbody></table>
<div class='btns'>
<div id='picturespick'>选择文件</div>
</div>
</div>
 						</div>
 					</div>
				  
                </div>
                <div class="card-footer">
				
				 <button class="btn btn-info" type="button" onclick="addOrUpdate();">确定</button>
                  <button class="btn btn-default float-right" type="button" onclick="gobackPage();">取消</button>
				  
                </div>
              </form>
            </div>
			  
          </div>
        </div>
      </div>
	  
	  
	  <div class="modal fade" id="residentDialog">
        <div class="modal-dialog">
          <div class="modal-content" style="width:1000px;">
            <div class="modal-header">
              <h4 class="modal-title">居民选择</h4>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              
			  <form class="form-horizontal">
                  <div class="form-group row">
                    <label for="inputEmail3" class="col-sm-1 col-form-label">姓名</label>
                    <div class="col-sm-2">
                      <input class="form-control" id="residentNameQry">
                    </div>
					
					<button id="btnSearch" type="button" class="btn btn-success" onclick="searchResident();">查询</button>
                  </div>
              </form>
			  
			  <div class="card-body">
                <table class="table table-bordered table-striped" id="dataTable">
                  <thead>
                  <tr>
                    <th style='text-align:center;'>姓名</th>
					<th style='text-align:center;'>身份证号</th>
					<th style='text-align:center;'>手机号</th>
					<th style='text-align:center;'>居住地</th>
                  </tr>
                  </thead>
				  <tbody></tbody>
                </table>
              </div>
			  
            </div>
            <div class="modal-footer justify-content-between">
              <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
              <!--button type="button" class="btn btn-primary">关闭</button-->
            </div>
          </div>
          <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
      </div>
	  
	  
	  
	  
	  <div class="modal fade" id="userDialog">
        <div class="modal-dialog">
          <div class="modal-content" style="width:1000px;">
            <div class="modal-header">
              <h4 class="modal-title">经办人选择</h4>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              
			  <form class="form-horizontal">
                  <div class="form-group row">
                    <label for="inputEmail3" class="col-sm-1 col-form-label">姓名</label>
                    <div class="col-sm-2">
                      <input class="form-control" id="userNameQry">
                    </div>
					
					<button id="btnSearch" type="button" class="btn btn-success" onclick="searchUser();">查询</button>
					
                  </div>
              </form>
			  
			  
			  <div class="card-body">
                <table class="table table-bordered table-striped" id="userDataTable">
                  <thead>
                  <tr>
                    <th style='text-align:center;'>姓名</th>
					<th style='text-align:center;'>部门</th>
					<th style='text-align:center;'>手机号</th>
                  </tr>
                  </thead>
				  <tbody></tbody>
                </table>
              </div>
			  
			  
            </div>
            <div class="modal-footer justify-content-between">
              <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
            </div>
          </div>
        </div>
      </div>
	  
	  
	  
	  
    </section>
		
	<script>


var uploaderpictures = WebUploader.create({
	auto: true,
// swf文件路径
//swf: BASE_URL + '/js/Uploader.swf',
// 文件接收服务端
server: getContextPath()+'/fileController/upload',
// 选择文件的按钮。可选。
// 内部根据当前运行是创建，可能是input元素，也可能是flash.
pick: '#picturespick',
formData:{
attributeName:'pictures'
}
});
uploaderpictures.on( 'fileQueued', function( file ) {
	$('#'+file.source._refer[0].id+'table').append('<tr><td>'+file.name+'</td><td id='+file.id+'>等待上传...</td>'+
						"<td><button type='button' id='"+file.id+"Button' class='btn btn-success btn-xs' onclick='javascript:downloadAttach();return false;'><i class='fa fa-check'></i></button></td>"+
						'</tr>');
});
uploaderpictures.on( 'uploadSuccess', function( file,response ) {
	$( '#'+response.attributeName ).val(response.fileName+VALUE_SPLITTER+$('#'+response.attributeName ).val());
	console.log($( '#'+response.attributeName ).val());
	$( '#'+file.id ).text('已上传');
	$('#'+file.id+'Button').attr('onclick', onclick='javascript:downloadAttach("'+response.fileName+'");return false;');
});
uploaderpictures.on( 'uploadError', function( file,response ) {
});	


function searchResident()
{
	var residentName = $('#residentNameQry').val();
	
	$.get(getContextPath()+'/residentController/load?name='+residentName,
	function(result){
		$('#btnSearch').removeAttr('disabled');
		var obj = jQuery.parseJSON(result);  
		if(obj.success)
		{
			dataTable = $('#dataTable').dataTable( {
				"processing": true,
				"bJQueryUI": false,
				"bFilter": false,
				"bStateSave":true,
				"bAutoWidth": false, //自适应宽度 
				iDisplayLength: 10,
				lengthChange: false,
				"bProcessing": true, 
				"bDestroy":true,
				"bSort": false, //是否使用排序 		
				/*"oLanguage": { 
					"sProcessing": "正在加载中......", 
					"sLengthMenu": "每页显示 _MENU_ 条记录", 
					"sZeroRecords": "对不起，查询不到相关数据！", 
					"sInfoEmpty":"",
					"sInfo": "当前显示 _START_ 到 _END_ 条，共 _TOTAL_ 条记录", 
					"sInfoFiltered": "数据表中共为 _MAX_ 条记录", 
					"sSearch": "搜索", 
					"oPaginate":  
					{ 
						"sFirst": "首页", 
						"sPrevious": "上一页", 
						"sNext": "下一页", 
						"sLast": "末页" 
					}
				}, *///多语言配置					
				"data":obj.list,
				"columns": [
					{ 'data': 'name' ,'sClass':'text-center'},
					{ 'data': 'idnumber' ,'sClass':'text-center'},
					{ 'data': 'mobile' ,'sClass':'text-center'},
					{ 'data': 'address' ,'sClass':'text-center'}
				],
				columnDefs: [
					{
					className: 'control',
					orderable: false,
					targets:  0,//从0开始
					mRender : function(data,type,full){
						var btn = "<a href=\"#\" onclick=\"selectResident('"+full.id+"','"+full.name+"','"+full.idnumber+"','"+full.mobile+"','"+full.address+"')\" data-toggle=\"tooltip\" title=\"查看\">"+full.name+"</a>";
						return btn;
					}
					}
				]
			} );
		}
	});
}

function selectResident(id,name,idnumber,mobile,address)
{
	$('#name').val(name);
	$('#idnumber').val(idnumber);
	$('#mobile').val(mobile);
	$('#address').val(address);
	
	$('#sxdsr').val(id);
	$('#sxdsrname').val(name);
}








function searchUser()
{
	var userName = $('#userNameQry').val();
	
	$.get(getContextPath()+'/userController/loadUser?name='+userName,
	function(result){
		$('#btnSearch').removeAttr('disabled');
		var obj = jQuery.parseJSON(result);  
		if(obj.success)
		{
			dataTable = $('#userDataTable').dataTable( {
				"processing": true,
				"bJQueryUI": false,
				"bFilter": false,
				"bStateSave":true,
				"bAutoWidth": false, //自适应宽度 
				iDisplayLength: 10,
				lengthChange: false,
				"bProcessing": true, 
				"bDestroy":true,
				"bSort": false, //是否使用排序 		
				/*"oLanguage": { 
					"sProcessing": "正在加载中......", 
					"sLengthMenu": "每页显示 _MENU_ 条记录", 
					"sZeroRecords": "对不起，查询不到相关数据！", 
					"sInfoEmpty":"",
					"sInfo": "当前显示 _START_ 到 _END_ 条，共 _TOTAL_ 条记录", 
					"sInfoFiltered": "数据表中共为 _MAX_ 条记录", 
					"sSearch": "搜索", 
					"oPaginate":  
					{ 
						"sFirst": "首页", 
						"sPrevious": "上一页", 
						"sNext": "下一页", 
						"sLast": "末页" 
					}
				}, *///多语言配置					
				"data":obj.list,
				"columns": [
					{ 'data': 'name' ,'sClass':'text-center'},
					{ 'data': 'organization' ,'sClass':'text-center'},
					{ 'data': 'address' ,'sClass':'text-center'}
				],
				columnDefs: [
					{
					className: 'control',
					orderable: false,
					targets:  0,//从0开始
					mRender : function(data,type,full){
						var btn = "<a href=\"#\" onclick=\"selectUser('"+full.id+"','"+full.name+"','"+full.idnumber+"','"+full.mobile+"','"+full.address+"')\" data-toggle=\"tooltip\" title=\"查看\">"+full.name+"</a>";
						return btn;
					}
					}
				]
			} );
		}
	});
}

function selectUser(id,name,idnumber,mobile,address)
{
	$('#sxjbr').val(id);
	$('#sxjbrname').val(name);
}
	</script>

